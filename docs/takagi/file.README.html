<!DOCTYPE html>
<html>
  <head>
    <base href="/docs/takagi/">
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  File: README
  
    &mdash; Documentation by YARD 0.9.38
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" />

  <link rel="stylesheet" href="css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "README";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-M7YHJSNC1F"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-M7YHJSNC1F');
    </script>
  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="file_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: README</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><div id='filecontents'><h1 id="takagi-lightweight-coap-framework-for-ruby">Takagi â€“ Lightweight CoAP Framework for Ruby</h1>

<p><a href="https://rubygems.org/gems/takagi"><img src="https://badge.fury.io/rb/takagi.svg" alt="Gem Version"></a>
<a href="https://github.com/domitea/takagi/actions"><img src="https://github.com/domitea/takagi/actions/workflows/main.yml/badge.svg" alt="Build Status"></a></p>

<h2 id="about-takagi">About Takagi</h2>

<p><strong>Takagi</strong> is a <strong>Sinatra-like CoAP framework</strong> for IoT and microservices in Ruby.<br>
It provides a lightweight way to build <strong>CoAP APIs</strong>, handle <strong>IoT messaging</strong>, and process sensor data efficiently.</p>

<p>ðŸ”¹ <strong>Minimalistic DSL</strong> â€“ Define CoAP endpoints just like in Sinatra.<br>
ðŸ”¹ <strong>CoRE discovery helpers</strong> â€“ Configure link-format metadata inline or at boot.<br>
ðŸ”¹ <strong>Efficient and fast</strong> â€“ Runs over UDP, ideal for IoT applications.<br>
ðŸ”¹ <strong>Reliable transport</strong> â€“ Supports CoAP over TCP (RFC 8323).</p>

<h2 id="why-takagi">Why &quot;Takagi&quot;?</h2>

<p>The name <strong>Takagi</strong> is inspired by <strong>Riyoko Takagi</strong>, as a nod to the naming convention of Sinatra.
Just like Sinatra simplified web applications in Ruby, Takagi aims to simplify CoAP-based IoT communication in Ruby. It embodies minimalism, efficiency, and a straightforward approach to handling CoAP requests.
Additionally, both Sinatra and Takagi share a connection to <strong>jazz music</strong>, as Riyoko Takagi is a known jazz pianist, much like how Sinatra was named after the legendary Frank Sinatra.</p>

<hr>

<h2 id="philosophy">Philosophy</h2>

<p><strong>Takagi treats CoAP as a first-class HTTP-equivalent protocol.</strong></p>

<p>CoAP (RFC 7252) was explicitly designed to mirror HTTP semantics for constrained environments. Yet most CoAP libraries (libcoap, aiocoap, californium) force developers into unfamiliar programming patterns that ignore decades of HTTP best practices.</p>

<p>Takagi rejects this approach. If CoAP is &quot;HTTP for IoT,&quot; then CoAP servers should feel like HTTP servers. Routes, middleware, REST semanticsâ€”these patterns work. Why abandon them?</p>

<p><strong>Takagi brings Sinatra&#39;s elegance to CoAP.</strong> If you can build a web API, you can build an IoT API.</p>

<hr>

<h2 id="installation">Installation</h2>

<p>Add this line to your application&#39;s Gemfile:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_gem'>gem</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>takagi</span><span class='tstring_end'>&#39;</span></span>
</code></pre>

<p>Or install it manually:</p>

<pre class="code sh"><code class="sh">gem install takagi
</code></pre>

<hr>

<h2 id="getting-started">Getting Started</h2>

<h3 id="create-a-new-takagi-api"><strong>Create a new Takagi API</strong></h3>

<p>Takagi provides a <strong>Sinatra-like DSL</strong> with modern Ruby conveniences:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>takagi</span><span class='tstring_end'>&#39;</span></span>

<span class='kw'>class</span> <span class='const'>SensorAPI</span> <span class='op'>&lt;</span> <span class='const'><span class='object_link'><a href="Takagi.html" title="Takagi (module)">Takagi</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/Base.html" title="Takagi::Base (class)">Base</a></span></span>
  <span class='comment'># Simple GET with auto-extracted params
</span>  <span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/sensor/:id</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_json'>json</span> <span class='label'>id:</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='label'>value:</span> <span class='float'>22.5</span><span class='comma'>,</span> <span class='label'>status:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>active</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>

  <span class='comment'># POST with validation helpers
</span>  <span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/sensor</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_validate_params'>validate_params</span> <span class='symbol'>:value</span>  <span class='comment'># Raises if missing
</span>
    <span class='id identifier rubyid_created'>created</span> <span class='label'>sensor_id:</span> <span class='id identifier rubyid_rand'>rand</span><span class='lparen'>(</span><span class='int'>1000</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='label'>value:</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:value</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='comment'># Early returns with halt
</span>  <span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/restricted</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_halt'>halt</span> <span class='id identifier rubyid_forbidden'>forbidden</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Access denied</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_authorized?'>authorized?</span>
    <span class='id identifier rubyid_json'>json</span> <span class='label'>message:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Welcome</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>

  <span class='comment'># Delete with status helpers
</span>  <span class='id identifier rubyid_delete'>delete</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/sensor/:id</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_deleted'>deleted</span> <span class='label'>message:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Sensor </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> removed</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='const'>SensorAPI</span><span class='period'>.</span><span class='id identifier rubyid_run!'>run!</span>
<span class='comment'># To serve CoAP over TCP instead of UDP:
</span><span class='comment'># SensorAPI.run!(protocols: [:tcp])
</span><span class='comment'># To serve both TCP and UDP simultaneously:
</span><span class='comment'># SensorAPI.run!(protocols: [:udp, :tcp])
</span></code></pre>

<p>ðŸ”¥ <strong>Boom! You just built a CoAP API in Ruby.</strong></p>

<h3 id="configure-core-discovery-metadata"><strong>Configure CoRE discovery metadata</strong></h3>

<p>Expose meaningful attributes in <code>/.well-known/core</code> either inline or after registration:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>SensorAPI</span> <span class='op'>&lt;</span> <span class='const'><span class='object_link'><a href="Takagi.html" title="Takagi (module)">Takagi</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/Base.html" title="Takagi::Base (class)">Base</a></span></span>
  <span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/metrics</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_core'>core</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_title'>title</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Environment Metrics</span><span class='tstring_end'>&#39;</span></span>
      <span class='id identifier rubyid_rt'>rt</span> <span class='qwords_beg'>%w[</span><span class='tstring_content'>sensor.metrics</span><span class='words_sep'> </span><span class='tstring_content'>sensor.temp</span><span class='tstring_end'>]</span></span>
      <span class='id identifier rubyid_interface'>interface</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>core.s</span><span class='tstring_end'>&#39;</span></span>
      <span class='id identifier rubyid_sz'>sz</span> <span class='int'>256</span> <span class='comment'># expected size of data
</span>    <span class='kw'>end</span>

    <span class='lbrace'>{</span> <span class='label'>temp:</span> <span class='float'>21.4</span><span class='comma'>,</span> <span class='label'>humidity:</span> <span class='float'>0.48</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='comment'># Configure discovery data separately (e.g. in an initializer):
</span><span class='const'>SensorAPI</span><span class='period'>.</span><span class='id identifier rubyid_core'>core</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/metrics</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_title'>title</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Environment Metrics</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_ct'>ct</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>application/cbor</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span>
</code></pre>

<p>Both approaches share the same DSL, so you can keep route handlers focused while still
publishing rich metadata.</p>

<h3 id="but-coap-is-not-only-get-post-put-and-delete-there-is-also-observe"><strong>But CoAP is not only GET, POST, PUT and DELETE. There is also Observe!</strong></h3>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>takagi</span><span class='tstring_end'>&#39;</span></span>

<span class='kw'>class</span> <span class='const'>SensorAPI</span> <span class='op'>&lt;</span> <span class='const'><span class='object_link'><a href="Takagi.html" title="Takagi (module)">Takagi</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/Base.html" title="Takagi::Base (class)">Base</a></span></span>
  <span class='id identifier rubyid_reactor'>reactor</span> <span class='kw'>do</span>
    <span class='comment'># observable: Server-side - make a resource observable by clients
</span>    <span class='id identifier rubyid_observable'>observable</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/sensors/temp</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
      <span class='id identifier rubyid_core'>core</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_title'>title</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Temperature Stream</span><span class='tstring_end'>&#39;</span></span>
        <span class='id identifier rubyid_rt'>rt</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sensor.temp.streaming</span><span class='tstring_end'>&#39;</span></span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_json'>json</span> <span class='label'>temp:</span> <span class='float'>42.0</span><span class='comma'>,</span> <span class='label'>unit:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>celsius</span><span class='tstring_end'>&#39;</span></span>
    <span class='kw'>end</span>

    <span class='comment'># observe: Client-side - subscribe to remote observable resources
</span>    <span class='id identifier rubyid_observe'>observe</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>coap://temp_server/temp</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_request'>request</span><span class='comma'>,</span> <span class='id identifier rubyid_params'>params</span><span class='op'>|</span>
      <span class='const'><span class='object_link'><a href="Takagi.html" title="Takagi (module)">Takagi</a></span></span><span class='period'>.</span><span class='id identifier rubyid_logger'><span class='object_link'><a href="Takagi.html#logger-class_method" title="Takagi.logger (method)">logger</a></span></span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Remote temperature update: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_params'>params</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='const'>SensorAPI</span><span class='period'>.</span><span class='id identifier rubyid_run!'>run!</span>
</code></pre>

<p>ðŸ”¥ <strong>Takagi is Observe (RFC 7641) enabled</strong></p>

<p><strong>Important distinction:</strong></p>

<ul>
<li><strong><code>observable</code></strong> - Server-side: Makes your resource observable by clients</li>
<li><strong><code>observe</code></strong> - Client-side: Subscribe to remote observable resources</li>
</ul>

<hr>

<h2 id="other-features">Other features</h2>

<p>Takagi provides a rich set of helper methods to make your code cleaner and more intuitive. 
Why? Because even if CoAP is like HTTP, then you should make new endpoints with ease.</p>

<h3 id="response-helpers"><strong>Response Helpers</strong></h3>

<p>Instead of manually constructing responses, use semantic helpers:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>MyAPI</span> <span class='op'>&lt;</span> <span class='const'><span class='object_link'><a href="Takagi.html" title="Takagi (module)">Takagi</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/Base.html" title="Takagi::Base (class)">Base</a></span></span>
  <span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/users</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_json'>json</span> <span class='label'>users:</span> <span class='const'>User</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>  <span class='comment'># Returns 2.05 Content
</span>  <span class='kw'>end</span>

  <span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/users</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_validate_params'>validate_params</span> <span class='symbol'>:name</span><span class='comma'>,</span> <span class='symbol'>:email</span>
    <span class='id identifier rubyid_created'>created</span> <span class='label'>user_id:</span> <span class='int'>123</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span>  <span class='comment'># Returns 2.01 Created
</span>  <span class='kw'>end</span>

  <span class='id identifier rubyid_put'>put</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/users/:id</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_changed'>changed</span> <span class='label'>message:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>User updated</span><span class='tstring_end'>&#39;</span></span>  <span class='comment'># Returns 2.04 Changed
</span>  <span class='kw'>end</span>

  <span class='id identifier rubyid_delete'>delete</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/users/:id</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_deleted'>deleted</span> <span class='label'>message:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>User removed</span><span class='tstring_end'>&#39;</span></span>  <span class='comment'># Returns 2.02 Deleted
</span>  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<p><strong>Available response helpers:</strong></p>

<ul>
<li><code>json(data)</code> - 2.05 Content</li>
<li><code>created(data)</code> - 2.01 Created</li>
<li><code>changed(data)</code> - 2.04 Changed</li>
<li><code>deleted(data)</code> - 2.02 Deleted</li>
<li><code>valid(data)</code> - 2.03 Valid</li>
<li><code>respond(payload, code: 2.05, formats: [ct], force: nil)</code> - negotiate <code>Content-Format</code> via <code>Accept</code>/defaults and build the CoAP response for you. <code>formats</code> is the allowed list; <code>force</code> pins a format (e.g., SenML CBOR) and returns <code>4.15</code> if unsupported. Unsupported <code>Accept</code> yields <code>4.06</code>.

<ul>
<li>If you declare <code>ct</code> in your CoRE metadata, <code>respond</code> will use that as the allowed list automatically, so discovery and runtime stay in sync.</li>
</ul></li>
</ul>

<p>Quick examples:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/sensor</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='comment'># Default (router content-format, typically JSON)
</span>  <span class='id identifier rubyid_respond'>respond</span><span class='lparen'>(</span><span class='label'>sensor:</span> <span class='float'>22.5</span><span class='rparen'>)</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/sensor</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='comment'># Allow JSON or CBOR, honor Accept
</span>  <span class='id identifier rubyid_respond'>respond</span><span class='lparen'>(</span><span class='lbrace'>{</span> <span class='label'>sensor:</span> <span class='float'>22.5</span> <span class='rbrace'>}</span><span class='comma'>,</span> <span class='label'>formats:</span> <span class='lbracket'>[</span>
    <span class='const'>CoAP</span><span class='op'>::</span><span class='const'>Registries</span><span class='op'>::</span><span class='const'>ContentFormat</span><span class='op'>::</span><span class='const'>JSON</span><span class='comma'>,</span>
    <span class='const'>CoAP</span><span class='op'>::</span><span class='const'>Registries</span><span class='op'>::</span><span class='const'>ContentFormat</span><span class='op'>::</span><span class='const'>CBOR</span>
  <span class='rbracket'>]</span><span class='rparen'>)</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/senml</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='comment'># Force a required format (e.g., SenML CBOR)
</span>  <span class='id identifier rubyid_respond'>respond</span><span class='lparen'>(</span><span class='id identifier rubyid_senml_payload'>senml_payload</span><span class='comma'>,</span> <span class='label'>force:</span> <span class='const'>CoAP</span><span class='op'>::</span><span class='const'>Registries</span><span class='op'>::</span><span class='const'>ContentFormat</span><span class='op'>::</span><span class='const'>CBOR</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</code></pre>

<h3 id="error-response-helpers"><strong>Error Response Helpers</strong></h3>

<p>Handle errors elegantly with built-in helpers:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>MyAPI</span> <span class='op'>&lt;</span> <span class='const'><span class='object_link'><a href="Takagi.html" title="Takagi (module)">Takagi</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/Base.html" title="Takagi::Base (class)">Base</a></span></span>
  <span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/resource/:id</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_halt'>halt</span> <span class='id identifier rubyid_not_found'>not_found</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Resource </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> not found</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_exists?'>exists?</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_json'>json</span> <span class='label'>data:</span> <span class='id identifier rubyid_fetch_resource'>fetch_resource</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/restricted</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_halt'>halt</span> <span class='id identifier rubyid_unauthorized'>unauthorized</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Please authenticate</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_authenticated?'>authenticated?</span>
    <span class='id identifier rubyid_halt'>halt</span> <span class='id identifier rubyid_forbidden'>forbidden</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Insufficient permissions</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_authorized?'>authorized?</span>

    <span class='id identifier rubyid_created'>created</span> <span class='label'>message:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Success</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/validate</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_halt'>halt</span> <span class='id identifier rubyid_bad_request'>bad_request</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Invalid input</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_valid_input?'>valid_input?</span>

    <span class='id identifier rubyid_json'>json</span> <span class='label'>status:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>ok</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<p><strong>Available error helpers:</strong></p>

<ul>
<li><code>bad_request(msg)</code> - 4.00 Bad Request</li>
<li><code>unauthorized(msg)</code> - 4.01 Unauthorized</li>
<li><code>forbidden(msg)</code> - 4.03 Forbidden</li>
<li><code>not_found(msg)</code> - 4.04 Not Found</li>
<li><code>method_not_allowed(msg)</code> - 4.05 Method Not Allowed</li>
<li><code>server_error(msg)</code> - 5.00 Internal Server Error</li>
<li><code>service_unavailable(msg)</code> - 5.03 Service Unavailable</li>
</ul>

<h3 id="plugins"><strong>Plugins</strong></h3>

<p>Ship features as plugins under <code>Takagi::Plugins::&lt;Name&gt;</code> with <code>.apply(app, opts = {})</code>. Plugins can:</p>

<ul>
<li>Add routes/controllers (optionally auto-prefixed via <code>route_prefix</code> metadata)</li>
<li>Register serializers/content-formats</li>
<li>Register new transports/servers</li>
<li>Extend CoAP registries (methods, responses, options, content-formats)</li>
<li>Hook into lifecycle events (<code>docs/FIRST_PLUGIN_GUIDE.md</code>, <code>docs/HOOKS.md</code>)</li>
</ul>

<p>Enable with <code>plugin :name, order: 0, **options</code> in your app and call <code>enable_plugins!</code>, or via config <code>plugins.enabled</code>. Use <code>dependencies: [{ name: :other, version: &#39;&gt;=1.0.0&#39; }]</code>, <code>requires: &#39;1.2.3&#39;</code>, <code>config_schema</code> for validated options, and <code>route_prefix</code> to isolate plugin routes. See <code>docs/FIRST_PLUGIN_GUIDE.md</code> for a full walkthrough.</p>

<h3 id="parameter-validation"><strong>Parameter Validation</strong></h3>

<p>Validate required parameters automatically:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>MyAPI</span> <span class='op'>&lt;</span> <span class='const'><span class='object_link'><a href="Takagi.html" title="Takagi (module)">Takagi</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/Base.html" title="Takagi::Base (class)">Base</a></span></span>
  <span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/sensor/reading</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
    <span class='comment'># Raises ArgumentError if any parameter is missing
</span>    <span class='id identifier rubyid_validate_params'>validate_params</span> <span class='symbol'>:temperature</span><span class='comma'>,</span> <span class='symbol'>:humidity</span><span class='comma'>,</span> <span class='symbol'>:timestamp</span>

    <span class='id identifier rubyid_created'>created</span><span class='lparen'>(</span>
      <span class='label'>reading_id:</span> <span class='id identifier rubyid_save_reading'>save_reading</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='rparen'>)</span><span class='comma'>,</span>
      <span class='label'>temperature:</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:temperature</span><span class='rbracket'>]</span>
    <span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<h3 id="auto-extracted-parameters"><strong>Auto-extracted Parameters</strong></h3>

<p>Parameters are automatically available without explicit block arguments:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>MyAPI</span> <span class='op'>&lt;</span> <span class='const'><span class='object_link'><a href="Takagi.html" title="Takagi (module)">Takagi</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/Base.html" title="Takagi::Base (class)">Base</a></span></span>
  <span class='comment'># Before: Had to specify params in arguments
</span>  <span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/old/:id</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_request'>request</span><span class='comma'>,</span> <span class='id identifier rubyid_params'>params</span><span class='op'>|</span>
    <span class='lbrace'>{</span> <span class='label'>id:</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='comment'># After: params available automatically!
</span>  <span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/new/:id</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_json'>json</span> <span class='label'>id:</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Resource </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='comment'># Still works with explicit args if needed
</span>  <span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/mixed/:id</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_request'>request</span><span class='comma'>,</span> <span class='id identifier rubyid_params'>params</span><span class='op'>|</span>
    <span class='id identifier rubyid_json'>json</span> <span class='label'>id:</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='label'>method:</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_method'>method</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<h3 id="request-inspection-helpers"><strong>Request Inspection Helpers</strong></h3>

<p>Easily inspect request properties:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>MyAPI</span> <span class='op'>&lt;</span> <span class='const'><span class='object_link'><a href="Takagi.html" title="Takagi (module)">Takagi</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/Base.html" title="Takagi::Base (class)">Base</a></span></span>
  <span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/data</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
    <span class='comment'># Check request method
</span>    <span class='kw'>return</span> <span class='id identifier rubyid_json'>json</span><span class='lparen'>(</span><span class='label'>method:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>GET</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_get?'>get?</span>

    <span class='comment'># Check Accept header
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_accept?'>accept?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>application/json</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_json'>json</span> <span class='label'>message:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>JSON format</span><span class='tstring_end'>&#39;</span></span>
    <span class='kw'>elsif</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_accept?'>accept?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>application/cbor</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_json'>json</span> <span class='label'>message:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>CBOR format</span><span class='tstring_end'>&#39;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/search</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
    <span class='comment'># Access query parameters
</span>    <span class='id identifier rubyid_query'>query</span> <span class='op'>=</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_query_params'>query_params</span>
    <span class='id identifier rubyid_json'>json</span> <span class='label'>query:</span> <span class='id identifier rubyid_query'>query</span><span class='comma'>,</span> <span class='label'>results:</span> <span class='id identifier rubyid_search'>search</span><span class='lparen'>(</span><span class='id identifier rubyid_query'>query</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>q</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/upload</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
    <span class='comment'># Get content format
</span>    <span class='id identifier rubyid_format'>format</span> <span class='op'>=</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_content_format'>content_format</span>
    <span class='id identifier rubyid_json'>json</span> <span class='label'>received_format:</span> <span class='id identifier rubyid_format'>format</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<p><strong>Available request helpers:</strong></p>

<ul>
<li><code>request.get?</code> / <code>post?</code> / <code>put?</code> / <code>delete?</code> / <code>observe?</code> - Check request method</li>
<li><code>request.accept?(format)</code> - Check if request accepts a format</li>
<li><code>request.content_format</code> - Get Content-Format option</li>
<li><code>request.query_params</code> - Get query parameters as hash</li>
<li><code>request.option(number)</code> - Get CoAP option by number</li>
<li><code>request.option?(number)</code> - Check if option exists</li>
</ul>

<h3 id="early-returns-with-halt"><strong>Early Returns with <code>halt</code></strong></h3>

<p>Use <code>halt</code> for cleaner early returns:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>MyAPI</span> <span class='op'>&lt;</span> <span class='const'><span class='object_link'><a href="Takagi.html" title="Takagi (module)">Takagi</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/Base.html" title="Takagi::Base (class)">Base</a></span></span>
  <span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/resource/:id</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_halt'>halt</span> <span class='id identifier rubyid_not_found'>not_found</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Not found</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_exists?'>exists?</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_halt'>halt</span> <span class='id identifier rubyid_forbidden'>forbidden</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Access denied</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_can_access?'>can_access?</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>

    <span class='comment'># Main logic only executes if checks pass
</span>    <span class='id identifier rubyid_json'>json</span> <span class='label'>data:</span> <span class='id identifier rubyid_fetch_resource'>fetch_resource</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<h3 id="observable-resources"><strong>Observable Resources</strong></h3>

<p>Make resources observable by clients using the <code>observable</code> method:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>MyAPI</span> <span class='op'>&lt;</span> <span class='const'><span class='object_link'><a href="Takagi.html" title="Takagi (module)">Takagi</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/Base.html" title="Takagi::Base (class)">Base</a></span></span>
  <span class='id identifier rubyid_reactor'>reactor</span> <span class='kw'>do</span>
    <span class='comment'># Server-side: Offer an observable resource
</span>    <span class='id identifier rubyid_observable'>observable</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/sensor/temp</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
      <span class='id identifier rubyid_core'>core</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_rt'>rt</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sensor.temperature</span><span class='tstring_end'>&#39;</span></span><span class='semicolon'>;</span> <span class='id identifier rubyid_obs'>obs</span> <span class='kw'>true</span> <span class='rbrace'>}</span>
      <span class='id identifier rubyid_json'>json</span> <span class='label'>temperature:</span> <span class='id identifier rubyid_read_sensor'>read_sensor</span><span class='comma'>,</span> <span class='label'>unit:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>celsius</span><span class='tstring_end'>&#39;</span></span>
    <span class='kw'>end</span>

    <span class='comment'># Client-side: Subscribe to a remote observable
</span>    <span class='id identifier rubyid_observe'>observe</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>coap://remote-server/sensor</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_request'>request</span><span class='comma'>,</span> <span class='id identifier rubyid_params'>params</span><span class='op'>|</span>
      <span class='const'><span class='object_link'><a href="Takagi.html" title="Takagi (module)">Takagi</a></span></span><span class='period'>.</span><span class='id identifier rubyid_logger'><span class='object_link'><a href="Takagi.html#logger-class_method" title="Takagi.logger (method)">logger</a></span></span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Received: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_params'>params</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<p><strong>Note:</strong></p>

<ul>
<li><code>observable</code> = Server-side (offer observations to clients)</li>
<li><code>observe</code> = Client-side (subscribe to remote resources)</li>
</ul>

<hr>

<h2 id="sending-requests-client-api">Sending Requests (Client API)</h2>

<p>Takagi provides a unified, Ruby-idiomatic client API for sending CoAP requests over both UDP and TCP.</p>

<h3 id="unified-client-with-auto-cleanup"><strong>Unified Client with Auto-Cleanup</strong></h3>

<p>The client follows Ruby conventions (like <code>File.open</code>) with block-based initialization for automatic resource cleanup:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># Block-based initialization (recommended - auto-cleanup)
</span><span class='const'><span class='object_link'><a href="Takagi.html" title="Takagi (module)">Takagi</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/Client.html" title="Takagi::Client (class)">Client</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Takagi/Client.html#initialize-instance_method" title="Takagi::Client#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>coap://localhost:5683</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_client'>client</span><span class='op'>|</span>
  <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/temperature</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span> <span class='comment'># Automatically cleaned up
</span>
<span class='comment'># Or with TCP
</span><span class='const'><span class='object_link'><a href="Takagi.html" title="Takagi (module)">Takagi</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/Client.html" title="Takagi::Client (class)">Client</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Takagi/Client.html#initialize-instance_method" title="Takagi::Client#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>coap+tcp://localhost:5683</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_client'>client</span><span class='op'>|</span>
  <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/temperature</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span>

<span class='comment'># Explicit protocol selection
</span><span class='const'><span class='object_link'><a href="Takagi.html" title="Takagi (module)">Takagi</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/Client.html" title="Takagi::Client (class)">Client</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Takagi/Client.html#initialize-instance_method" title="Takagi::Client#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>localhost:5683</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>protocol:</span> <span class='symbol'>:tcp</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_client'>client</span><span class='op'>|</span>
  <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/temperature</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span>
</code></pre>

<h3 id="response-wrapper-with-convenience-methods"><strong>Response Wrapper with Convenience Methods</strong></h3>

<p>Responses are wrapped with intuitive status checking methods:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><span class='object_link'><a href="Takagi.html" title="Takagi (module)">Takagi</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/Client.html" title="Takagi::Client (class)">Client</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Takagi/Client.html#initialize-instance_method" title="Takagi::Client#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>coap://localhost:5683</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_client'>client</span><span class='op'>|</span>
  <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/temperature</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_response'>response</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_success?'>success?</span>
      <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Temperature: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_payload'>payload</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Status: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_code_name'>code_name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>  <span class='comment'># &quot;2.05 Content&quot;
</span>    <span class='kw'>elsif</span> <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_not_found?'>not_found?</span>
      <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Resource not found</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>elsif</span> <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_error?'>error?</span>
      <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Error: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_code_name'>code_name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<p><strong>Available response methods:</strong></p>

<ul>
<li><strong>Status checking:</strong> <code>success?</code>, <code>error?</code>, <code>client_error?</code>, <code>server_error?</code></li>
<li><strong>Specific codes:</strong> <code>ok?</code>, <code>created?</code>, <code>deleted?</code>, <code>changed?</code>, <code>valid?</code>, <code>not_found?</code>, <code>bad_request?</code>, <code>unauthorized?</code>, <code>forbidden?</code>, <code>internal_server_error?</code></li>
<li><strong>Data access:</strong> <code>payload</code>, <code>code</code>, <code>code_name</code>, <code>options</code>, <code>token</code></li>
<li><strong>JSON support:</strong> <code>json</code>, <code>json?</code>, <code>content_format</code></li>
</ul>

<h3 id="json-convenience-methods"><strong>JSON Convenience Methods</strong></h3>

<p>Simplified JSON handling with automatic encoding and decoding:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><span class='object_link'><a href="Takagi.html" title="Takagi (module)">Takagi</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/Client.html" title="Takagi::Client (class)">Client</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Takagi/Client.html#initialize-instance_method" title="Takagi::Client#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>coap://localhost:5683</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_client'>client</span><span class='op'>|</span>
  <span class='comment'># Automatic JSON encoding
</span>  <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_post_json'>post_json</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/data</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='label'>temp:</span> <span class='int'>25</span><span class='comma'>,</span> <span class='label'>humidity:</span> <span class='int'>60</span><span class='rbrace'>}</span><span class='rparen'>)</span>

  <span class='comment'># Automatic JSON parsing
</span>  <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_get_json'>get_json</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/data</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_data'>data</span><span class='op'>|</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>temp</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>  <span class='comment'># Already parsed!
</span>  <span class='kw'>end</span>

  <span class='comment'># Or check content type manually
</span>  <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/data</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_response'>response</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_json?'>json?</span>
      <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_json'>json</span>
      <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>temp</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<h3 id="all-http-like-methods"><strong>All HTTP-Like Methods</strong></h3>

<p>The client supports all standard CoAP methods:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><span class='object_link'><a href="Takagi.html" title="Takagi (module)">Takagi</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/Client.html" title="Takagi::Client (class)">Client</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Takagi/Client.html#initialize-instance_method" title="Takagi::Client#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>coap://localhost:5683</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_client'>client</span><span class='op'>|</span>
  <span class='comment'># GET request
</span>  <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/sensor/1</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_response'>response</span><span class='op'>|</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_payload'>payload</span> <span class='kw'>if</span> <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_success?'>success?</span>
  <span class='kw'>end</span>

  <span class='comment'># POST request
</span>  <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_post'>post</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/sensor</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>temperature=25</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_response'>response</span><span class='op'>|</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Created: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_created?'>created?</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='comment'># PUT request
</span>  <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_put'>put</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/sensor/1</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>temperature=26</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_response'>response</span><span class='op'>|</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Changed: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_changed?'>changed?</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='comment'># DELETE request
</span>  <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/sensor/1</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_response'>response</span><span class='op'>|</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Deleted: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_deleted?'>deleted?</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<h3 id="readable-default-output"><strong>Readable Default Output</strong></h3>

<p>Without a block, responses print human-readable output:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><span class='object_link'><a href="Takagi.html" title="Takagi (module)">Takagi</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/Client.html" title="Takagi::Client (class)">Client</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Takagi/Client.html#initialize-instance_method" title="Takagi::Client#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>coap://localhost:5683</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_client'>client</span><span class='op'>|</span>
  <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/resource</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='comment'># Prints: [2.05 Content] Hello World
</span>
  <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/missing</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='comment'># Prints: [ERROR 4.04 Not Found] Resource not available
</span><span class='kw'>end</span>
</code></pre>

<h3 id="using-coap-client-cli"><strong>Using <code>coap-client</code> CLI</strong></h3>

<p>For quick testing, you can also use the standard CoAP command-line tools:</p>

<pre class="code sh"><code class="sh">coap-client -m get coap://localhost:5683/sensor/1
</code></pre>

<pre class="code sh"><code class="sh">coap-client -m post coap://localhost:5683/sensor -e &#39;{&quot;value&quot;:42}&#39;
</code></pre>

<hr>

<h2 id="coap-protocol-registry-system">CoAP Protocol Registry System</h2>

<p>Takagi includes an extensible registry system for protocol constants, providing a plugin-friendly architecture where custom methods, response codes, options, and content formats can be registered.</p>

<h2 id="plugin-system">Plugin System</h2>

<p>Takagi ships with an EventBus-backed plugin manager for runtime extensions and future clustering.</p>

<ul>
<li><strong>Auto-discovery</strong>: Finds plugins under <code>Takagi::Plugins::*</code> and <code>takagi-plugin-*</code> gems (configurable via <code>plugins.auto_discover</code>).</li>
<li><strong>Config + DSL</strong>: Declare in code (<code>plugin MyPlugin, opt: 1</code>) or YAML:
<code>yaml
plugins:
auto_discover: true
enabled:
  - name: request_logging
    options:
      sample_rate: 0.1
  - prometheus
</code></li>
<li><strong>Lifecycle hooks</strong>: Plugins may implement <code>before_apply/apply/after_apply</code> (plus <code>before_unload/shutdown</code>). Events publish to <code>hooks.plugin_*</code> on the EventBus.</li>
<li><strong>Deps &amp; versions</strong>: <code>metadata</code> supports <code>dependencies:</code> and <code>requires:</code>; dependencies auto-enable first and versions are checked.</li>
<li><strong>Config schema</strong>: Optional <code>config_schema</code> validates types/enums/ranges and fills defaults before apply.</li>
<li><strong>Hooked internals</strong>: Core emits <code>hooks.*</code> for registry changes, route additions, middleware before/after, server start/stop, Observe subscribe/notifyâ€”ready for observability across nodes.</li>
</ul>

<p>Quick start:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>MyApp</span> <span class='op'>&lt;</span> <span class='const'><span class='object_link'><a href="Takagi.html" title="Takagi (module)">Takagi</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/Base.html" title="Takagi::Base (class)">Base</a></span></span>
  <span class='id identifier rubyid_plugin'>plugin</span> <span class='const'><span class='object_link'><a href="Takagi.html" title="Takagi (module)">Takagi</a></span></span><span class='op'>::</span><span class='const'>Plugins</span><span class='op'>::</span><span class='const'>RequestLogging</span><span class='comma'>,</span> <span class='label'>sample_rate:</span> <span class='float'>0.2</span>
<span class='kw'>end</span>

<span class='const'>MyApp</span><span class='period'>.</span><span class='id identifier rubyid_run!'>run!</span> <span class='comment'># enables plugins from DSL + config
</span></code></pre>

<h3 id="using-protocol-constants"><strong>Using Protocol Constants</strong></h3>

<p>All CoAP constants are organized into registries that follow RFC specifications:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># Method codes (RFC 7252 Â§12.1.1)
</span><span class='const'><span class='object_link'><a href="Takagi.html" title="Takagi (module)">Takagi</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/CoAP.html" title="Takagi::CoAP (module)">CoAP</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/CoAP/Registries.html" title="Takagi::CoAP::Registries (module)">Registries</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/CoAP/Registries/Method.html" title="Takagi::CoAP::Registries::Method (class)">Method</a></span></span><span class='op'>::</span><span class='const'>GET</span>     <span class='comment'># =&gt; 1
</span><span class='const'><span class='object_link'><a href="Takagi.html" title="Takagi (module)">Takagi</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/CoAP.html" title="Takagi::CoAP (module)">CoAP</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/CoAP/Registries.html" title="Takagi::CoAP::Registries (module)">Registries</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/CoAP/Registries/Method.html" title="Takagi::CoAP::Registries::Method (class)">Method</a></span></span><span class='op'>::</span><span class='const'>POST</span>    <span class='comment'># =&gt; 2
</span>
<span class='comment'># Response codes (RFC 7252 Â§12.1.2)
</span><span class='const'><span class='object_link'><a href="Takagi.html" title="Takagi (module)">Takagi</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/CoAP.html" title="Takagi::CoAP (module)">CoAP</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/CoAP/Registries.html" title="Takagi::CoAP::Registries (module)">Registries</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/CoAP/Registries/Response.html" title="Takagi::CoAP::Registries::Response (class)">Response</a></span></span><span class='op'>::</span><span class='const'>CONTENT</span>     <span class='comment'># =&gt; 69 (2.05)
</span><span class='const'><span class='object_link'><a href="Takagi.html" title="Takagi (module)">Takagi</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/CoAP.html" title="Takagi::CoAP (module)">CoAP</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/CoAP/Registries.html" title="Takagi::CoAP::Registries (module)">Registries</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/CoAP/Registries/Response.html" title="Takagi::CoAP::Registries::Response (class)">Response</a></span></span><span class='op'>::</span><span class='const'>NOT_FOUND</span>   <span class='comment'># =&gt; 132 (4.04)
</span>
<span class='comment'># Options (RFC 7252 Â§5.10)
</span><span class='const'><span class='object_link'><a href="Takagi.html" title="Takagi (module)">Takagi</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/CoAP.html" title="Takagi::CoAP (module)">CoAP</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/CoAP/Registries.html" title="Takagi::CoAP::Registries (module)">Registries</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/CoAP/Registries/Option.html" title="Takagi::CoAP::Registries::Option (class)">Option</a></span></span><span class='op'>::</span><span class='const'>URI_PATH</span>         <span class='comment'># =&gt; 11
</span><span class='const'><span class='object_link'><a href="Takagi.html" title="Takagi (module)">Takagi</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/CoAP.html" title="Takagi::CoAP (module)">CoAP</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/CoAP/Registries.html" title="Takagi::CoAP::Registries (module)">Registries</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/CoAP/Registries/Option.html" title="Takagi::CoAP::Registries::Option (class)">Option</a></span></span><span class='op'>::</span><span class='const'>CONTENT_FORMAT</span>   <span class='comment'># =&gt; 12
</span>
<span class='comment'># Content formats (RFC 7252 Â§12.3)
</span><span class='const'><span class='object_link'><a href="Takagi.html" title="Takagi (module)">Takagi</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/CoAP.html" title="Takagi::CoAP (module)">CoAP</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/CoAP/Registries.html" title="Takagi::CoAP::Registries (module)">Registries</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/CoAP/Registries/ContentFormat.html" title="Takagi::CoAP::Registries::ContentFormat (class)">ContentFormat</a></span></span><span class='op'>::</span><span class='const'>JSON</span>        <span class='comment'># =&gt; 50
</span><span class='const'><span class='object_link'><a href="Takagi.html" title="Takagi (module)">Takagi</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/CoAP.html" title="Takagi::CoAP (module)">CoAP</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/CoAP/Registries.html" title="Takagi::CoAP::Registries (module)">Registries</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/CoAP/Registries/ContentFormat.html" title="Takagi::CoAP::Registries::ContentFormat (class)">ContentFormat</a></span></span><span class='op'>::</span><span class='const'>TEXT_PLAIN</span>  <span class='comment'># =&gt; 0
</span></code></pre>

<h3 id="code-conversion-helpers"><strong>Code Conversion Helpers</strong></h3>

<p>Convert between different representations easily:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># Convert code to human-readable string
</span><span class='const'><span class='object_link'><a href="Takagi.html" title="Takagi (module)">Takagi</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/CoAP.html" title="Takagi::CoAP (module)">CoAP</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/CoAP/CodeHelpers.html" title="Takagi::CoAP::CodeHelpers (module)">CodeHelpers</a></span></span><span class='period'>.</span><span class='id identifier rubyid_to_string'><span class='object_link'><a href="Takagi/CoAP/CodeHelpers.html#to_string-class_method" title="Takagi::CoAP::CodeHelpers.to_string (method)">to_string</a></span></span><span class='lparen'>(</span><span class='int'>69</span><span class='rparen'>)</span>      <span class='comment'># =&gt; &quot;2.05 Content&quot;
</span><span class='const'><span class='object_link'><a href="Takagi.html" title="Takagi (module)">Takagi</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/CoAP.html" title="Takagi::CoAP (module)">CoAP</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/CoAP/CodeHelpers.html" title="Takagi::CoAP::CodeHelpers (module)">CodeHelpers</a></span></span><span class='period'>.</span><span class='id identifier rubyid_to_string'><span class='object_link'><a href="Takagi/CoAP/CodeHelpers.html#to_string-class_method" title="Takagi::CoAP::CodeHelpers.to_string (method)">to_string</a></span></span><span class='lparen'>(</span><span class='symbol'>:get</span><span class='rparen'>)</span>    <span class='comment'># =&gt; &quot;GET&quot;
</span>
<span class='comment'># Convert to numeric code
</span><span class='const'><span class='object_link'><a href="Takagi.html" title="Takagi (module)">Takagi</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/CoAP.html" title="Takagi::CoAP (module)">CoAP</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/CoAP/CodeHelpers.html" title="Takagi::CoAP::CodeHelpers (module)">CodeHelpers</a></span></span><span class='period'>.</span><span class='id identifier rubyid_to_numeric'><span class='object_link'><a href="Takagi/CoAP/CodeHelpers.html#to_numeric-class_method" title="Takagi::CoAP::CodeHelpers.to_numeric (method)">to_numeric</a></span></span><span class='lparen'>(</span><span class='symbol'>:get</span><span class='rparen'>)</span>       <span class='comment'># =&gt; 1
</span><span class='const'><span class='object_link'><a href="Takagi.html" title="Takagi (module)">Takagi</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/CoAP.html" title="Takagi::CoAP (module)">CoAP</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/CoAP/CodeHelpers.html" title="Takagi::CoAP::CodeHelpers (module)">CodeHelpers</a></span></span><span class='period'>.</span><span class='id identifier rubyid_to_numeric'><span class='object_link'><a href="Takagi/CoAP/CodeHelpers.html#to_numeric-class_method" title="Takagi::CoAP::CodeHelpers.to_numeric (method)">to_numeric</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>2.05</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>     <span class='comment'># =&gt; 69
</span>
<span class='comment'># Status checking
</span><span class='const'><span class='object_link'><a href="Takagi.html" title="Takagi (module)">Takagi</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/CoAP.html" title="Takagi::CoAP (module)">CoAP</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/CoAP/Registries.html" title="Takagi::CoAP::Registries (module)">Registries</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/CoAP/Registries/Response.html" title="Takagi::CoAP::Registries::Response (class)">Response</a></span></span><span class='period'>.</span><span class='id identifier rubyid_success?'><span class='object_link'><a href="Takagi/CoAP/Registries/Response.html#success%3F-class_method" title="Takagi::CoAP::Registries::Response.success? (method)">success?</a></span></span><span class='lparen'>(</span><span class='int'>69</span><span class='rparen'>)</span>        <span class='comment'># =&gt; true (2.xx)
</span><span class='const'><span class='object_link'><a href="Takagi.html" title="Takagi (module)">Takagi</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/CoAP.html" title="Takagi::CoAP (module)">CoAP</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/CoAP/Registries.html" title="Takagi::CoAP::Registries (module)">Registries</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/CoAP/Registries/Response.html" title="Takagi::CoAP::Registries::Response (class)">Response</a></span></span><span class='period'>.</span><span class='id identifier rubyid_client_error?'><span class='object_link'><a href="Takagi/CoAP/Registries/Response.html#client_error%3F-class_method" title="Takagi::CoAP::Registries::Response.client_error? (method)">client_error?</a></span></span><span class='lparen'>(</span><span class='int'>132</span><span class='rparen'>)</span>  <span class='comment'># =&gt; true (4.xx)
</span></code></pre>

<h3 id="plugin-development"><strong>Plugin Development</strong></h3>

<p>Extend the protocol by registering new constants at runtime:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># Register a custom method (RFC 8132 - FETCH)
</span><span class='const'><span class='object_link'><a href="Takagi.html" title="Takagi (module)">Takagi</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/CoAP.html" title="Takagi::CoAP (module)">CoAP</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/CoAP/Registries.html" title="Takagi::CoAP::Registries (module)">Registries</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/CoAP/Registries/Method.html" title="Takagi::CoAP::Registries::Method (class)">Method</a></span></span><span class='period'>.</span><span class='id identifier rubyid_register'><span class='object_link'><a href="Takagi/CoAP/Registries/Base.html#register-class_method" title="Takagi::CoAP::Registries::Base.register (method)">register</a></span></span><span class='lparen'>(</span><span class='int'>5</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>FETCH</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbol'>:fetch</span><span class='comma'>,</span> <span class='label'>rfc:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>RFC 8132 Â§2</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

<span class='comment'># Now available as constant
</span><span class='const'><span class='object_link'><a href="Takagi.html" title="Takagi (module)">Takagi</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/CoAP.html" title="Takagi::CoAP (module)">CoAP</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/CoAP/Registries.html" title="Takagi::CoAP::Registries (module)">Registries</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/CoAP/Registries/Method.html" title="Takagi::CoAP::Registries::Method (class)">Method</a></span></span><span class='op'>::</span><span class='const'>FETCH</span>  <span class='comment'># =&gt; 5
</span>
<span class='comment'># Register custom response codes
</span><span class='const'><span class='object_link'><a href="Takagi.html" title="Takagi (module)">Takagi</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/CoAP.html" title="Takagi::CoAP (module)">CoAP</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/CoAP/Registries.html" title="Takagi::CoAP::Registries (module)">Registries</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/CoAP/Registries/Response.html" title="Takagi::CoAP::Registries::Response (class)">Response</a></span></span><span class='period'>.</span><span class='id identifier rubyid_register'><span class='object_link'><a href="Takagi/CoAP/Registries/Base.html#register-class_method" title="Takagi::CoAP::Registries::Base.register (method)">register</a></span></span><span class='lparen'>(</span><span class='int'>231</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>7.07 Custom Code</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbol'>:custom_code</span><span class='rparen'>)</span>

<span class='comment'># Register custom options (e.g., for Block-Wise Transfer RFC 7959)
</span><span class='const'><span class='object_link'><a href="Takagi.html" title="Takagi (module)">Takagi</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/CoAP.html" title="Takagi::CoAP (module)">CoAP</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/CoAP/Registries.html" title="Takagi::CoAP::Registries (module)">Registries</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Takagi/CoAP/Registries/Option.html" title="Takagi::CoAP::Registries::Option (class)">Option</a></span></span><span class='period'>.</span><span class='id identifier rubyid_register'><span class='object_link'><a href="Takagi/CoAP/Registries/Base.html#register-class_method" title="Takagi::CoAP::Registries::Base.register (method)">register</a></span></span><span class='lparen'>(</span><span class='int'>23</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Block2</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbol'>:block2</span><span class='comma'>,</span> <span class='label'>rfc:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>RFC 7959 Â§2.2</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
</code></pre>

<p><strong>Benefits:</strong></p>

<ul>
<li>Single source of truth for all CoAP constants</li>
<li>Plugin-friendly architecture for extending with new RFCs</li>
<li>Self-documenting code (no magic numbers)</li>
<li>RFC-aligned structure with inline documentation</li>
<li>Type-safe with validation methods</li>
</ul>

<hr>

<h2 id="features-modules">Features &amp; Modules</h2>

<h3 id="server-features">Server Features</h3>

<table><thead>
<tr>
<th>Feature</th>
<th>Description</th>
<th>Status</th>
</tr>
</thead><tbody>
<tr>
<td><strong>CoAP API (RFC 7252)</strong></td>
<td>Define REST-like CoAP routes with Sinatra-like DSL</td>
<td>âœ… Ready</td>
</tr>
<tr>
<td><strong>CoRE metadata DSL (RFC 6690)</strong></td>
<td>Describe discovery attributes inline or at boot</td>
<td>âœ… Ready</td>
</tr>
<tr>
<td><strong>Observe (RFC 7641)</strong></td>
<td>Offer server push and subscribe to remote feeds</td>
<td>âœ… Ready</td>
</tr>
<tr>
<td><strong>CoAP over TCP (RFC 8323)</strong></td>
<td>Reliable transport for constrained clients</td>
<td>âœ… Ready</td>
</tr>
<tr>
<td><strong>Response Helpers</strong></td>
<td>Semantic helpers like <code>json</code>, <code>created</code>, <code>deleted</code></td>
<td>âœ… Ready</td>
</tr>
<tr>
<td><strong>Error Helpers</strong></td>
<td>Easy error responses with <code>not_found</code>, <code>forbidden</code>, etc.</td>
<td>âœ… Ready</td>
</tr>
<tr>
<td><strong>Auto-extracted Params</strong></td>
<td>No need to specify params in block arguments</td>
<td>âœ… Ready</td>
</tr>
<tr>
<td><strong>Request Helpers</strong></td>
<td>Inspect requests with <code>accept?</code>, <code>query_params</code>, etc.</td>
<td>âœ… Ready</td>
</tr>
<tr>
<td><strong>Validation Helpers</strong></td>
<td>Validate params with <code>validate_params</code></td>
<td>âœ… Ready</td>
</tr>
<tr>
<td><strong>Early Returns</strong></td>
<td>Use <code>halt</code> for cleaner control flow</td>
<td>âœ… Ready</td>
</tr>
<tr>
<td><strong>Observable/Observe</strong></td>
<td>Clear distinction: <code>observable</code> (server), <code>observe</code> (client)</td>
<td>âœ… Ready</td>
</tr>
</tbody></table>

<h3 id="client-features">Client Features</h3>

<table><thead>
<tr>
<th>Feature</th>
<th>Description</th>
<th>Status</th>
</tr>
</thead><tbody>
<tr>
<td><strong>Unified Client API</strong></td>
<td>Single interface for UDP and TCP with auto-protocol detection</td>
<td>âœ… Ready</td>
</tr>
<tr>
<td><strong>Block-based Initialization</strong></td>
<td>Auto-cleanup with Ruby-idiomatic block pattern</td>
<td>âœ… Ready</td>
</tr>
<tr>
<td><strong>Response Wrapper</strong></td>
<td>Convenient status checking with <code>success?</code>, <code>error?</code>, etc.</td>
<td>âœ… Ready</td>
</tr>
<tr>
<td><strong>JSON Convenience Methods</strong></td>
<td>Automatic JSON encoding/decoding with <code>post_json</code>, <code>get_json</code></td>
<td>âœ… Ready</td>
</tr>
<tr>
<td><strong>Readable Default Output</strong></td>
<td>Human-readable response formatting by default</td>
<td>âœ… Ready</td>
</tr>
<tr>
<td><strong>All CoAP Methods</strong></td>
<td>Support for GET, POST, PUT, DELETE over UDP/TCP</td>
<td>âœ… Ready</td>
</tr>
</tbody></table>

<h3 id="protocol-extension-features">Protocol &amp; Extension Features</h3>

<table><thead>
<tr>
<th>Feature</th>
<th>Description</th>
<th>Status</th>
</tr>
</thead><tbody>
<tr>
<td><strong>CoAP Registry System</strong></td>
<td>Extensible registry for protocol constants</td>
<td>âœ… Ready</td>
</tr>
<tr>
<td><strong>Protocol Constants</strong></td>
<td>RFC-aligned constants for methods, responses, options</td>
<td>âœ… Ready</td>
</tr>
<tr>
<td><strong>Code Helpers</strong></td>
<td>Convert between numeric codes and human-readable strings</td>
<td>âœ… Ready</td>
</tr>
<tr>
<td><strong>Plugin Architecture</strong></td>
<td>Register custom methods, options, and response codes</td>
<td>âœ… Ready</td>
</tr>
<tr>
<td><strong>RFC Documentation</strong></td>
<td>Inline RFC references for all constants</td>
<td>âœ… Ready</td>
</tr>
</tbody></table>

<hr>

<h2 id="contributing">Contributing</h2>

<p>Want to help? Fork the repo and submit a PR!</p>

<pre class="code sh"><code class="sh">git clone https://github.com/domitea/takagi.git
cd takagi
bundle install
</code></pre>

<p>Run tests:</p>

<pre class="code sh"><code class="sh">bundle exec rspec
</code></pre>

<hr>

<h2 id="license">License</h2>

<p><strong>MIT License</strong></p>

<hr>
</div></div>

      <div id="footer">
  Generated on Sat Dec 13 18:29:45 2025 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.38 (ruby-3.1.3).
</div>

    </div>
  </body>
</html>